version: '3.8'
services:
  db:
    container_name: mongodb
    image: mongo
    ports:
      - 27017:27017
    environment: 
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=toor
    volumes: 
      - mongodata:/data/db
  ds:
    container_name: ds
    build: ./../discovery-service
    image: finances_ds
    expose:
      - 8761
  gw:
    container_name: gw
    build: ./../gateway-service
    image: finances_gw
    expose:
      - 80
    ports:
      - 80:80
    environment:
      - EUREKA_SERVER=${EUREKA_DOCKER_ADDRESS}
      - OKTA_OAUTH2_CLIENT_ID=${OKTA_ID}
      - OKTA_OAUTH2_CLIENT_SECRET=${OKTA_SECRET}
      - WAIT_HOSTS=ds:8761
  us:
    container_name: us
    build: ./../user-service
    image: finances_us
    expose:
      - 8081
    environment:
      - EUREKA_SERVER=${EUREKA_DOCKER_ADDRESS} 
      - WAIT_HOSTS=ds:8761,mongodb:27017
    depends_on:
      - ds
      - db 
  cs:
    container_name: cs
    build: ./../category-service
    image: finances_cs
    expose:
      - 8082
    environment:
      - EUREKA_SERVER=${EUREKA_DOCKER_ADDRESS} 
      - WAIT_HOSTS=ds:8761,mongodb:27017
    depends_on:
      - ds
  inc:
    container_name: inc
    build: ./../income-service
    image: finances_inc
    expose:
      - 8083
    environment:
      - EUREKA_SERVER=${EUREKA_DOCKER_ADDRESS} 
      - WAIT_HOSTS=ds:8761,mongodb:27017
    depends_on:
      - ds
  exp:
    container_name: exp
    build: ./../expense-service
    image: finances_exp
    expose:
      - 8084
    environment:
      - EUREKA_SERVER=${EUREKA_DOCKER_ADDRESS} 
      - WAIT_HOSTS=ds:8761,mongodb:27017
    depends_on:
      - ds
  bud:
    container_name: bud
    build: ./../budget-service
    image: finances_bud
    expose:
      - 8085
    environment:
      - EUREKA_SERVER=${EUREKA_DOCKER_ADDRESS} 
      - WAIT_HOSTS=ds:8761,mongodb:27017
    depends_on:
      - ds
networks: 
  default:
    name: finances
volumes: 
  mongodata: